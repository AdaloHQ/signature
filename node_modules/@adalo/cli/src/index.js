require('dotenv').config()
require('colors')
const axios = require('axios')
const { execSync } = require('child_process')

const build = require('./build')
const publish = require('./publish')
const dev = require('./dev')
const login = require('./login')

const execute = (command, args, opts) => {
  let commands = {
    build,
    publish,
    dev,
    login,
  }

  if (!commands[command]) {
    throw new Error(`No command "${command}"`)
    process.exit(1)
  }

  if (command !== 'login') {
    const { authToken } = require('./lib/auth')
    const token = authToken()

    // set defaults
    axios.defaults.headers['x-proton-auth'] = token
    axios.defaults.maxBodyLength = 1000000000
    axios.defaults.maxContentLength = 1000000000
  }

  // Execute command
  commands[command](args, opts)
}

module.exports = {
  execute,
}
